<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Forecast</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Sales and Quantity Forecast</h1>

        <!-- Forecast Data -->
        <div id="forecast-container" class="mb-4">
            <h3>Forecast Summary</h3>
            <div id="forecast-summary" class="row">
                <!-- Dynamic Forecast summary will be injected here -->
            </div>
        </div>

        <!-- Dry Season Data -->
        <div id="dry-season-container" class="mb-4">
            <h3>Dry Season Data</h3>
            <canvas id="dry-season-chart"></canvas>
        </div>

        <!-- Rainy Season Data -->
        <div id="rainy-season-container" class="mb-4">
            <h3>Rainy Season Data</h3>
            <canvas id="rainy-season-chart"></canvas>
        </div>

        <!-- Historical Predictions -->
        <div id="historical-predictions-container" class="mb-4">
            <h3>Historical Predictions</h3>
            <div id="historical-predictions"></div>
        </div>

        <!-- Future Predictions -->
        <div id="future-predictions-container" class="mb-4">
            <h3>Future Predictions</h3>
            <div id="future-predictions"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // Fetch forecast data from the API
        async function fetchForecastData() {
            try {
                const response = await fetch('/forecast');
                const data = await response.json();

                // Render forecast summary
                renderForecastSummary(data.forecast_data);

                // Render historical predictions
                renderHistoricalPredictions(data.dry_historical_predictions, 'Dry Season');
                renderHistoricalPredictions(data.rainy_historical_predictions, 'Rainy Season');

                // Render future predictions
                renderFuturePredictions(data.dry_forecast_monthly, 'Dry Season');
                renderFuturePredictions(data.rainy_forecast_monthly, 'Rainy Season');

                // Render season charts
                renderCharts(data.dry_season_data, 'dry-season-chart', 'Dry Season');
                renderCharts(data.rainy_season_data, 'rainy-season-chart', 'Rainy Season');
            } catch (error) {
                console.error('Error fetching forecast data:', error);
            }
        }

        // Render forecast summary
        function renderForecastSummary(forecastData) {
            const forecastContainer = document.getElementById('forecast-summary');
            forecastData.forEach(forecast => {
                const div = document.createElement('div');
                div.classList.add('col-md-6', 'mb-3');
                div.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">${forecast.label}</h5>
                            <p class="card-text">Total Sales Forecast: ₱${forecast.forecast_sales}</p>
                            <p class="card-text">Total Quantity Forecast: ${forecast.forecast_quantity}</p>
                            <p class="card-text">Sales Trend: ${forecast.trend_sales}</p>
                            <p class="card-text">Quantity Trend: ${forecast.trend_quantity}</p>
                        </div>
                    </div>
                `;
                forecastContainer.appendChild(div);
            });
        }

        // Render historical predictions
        function renderHistoricalPredictions(predictions, season) {
            const container = document.getElementById('historical-predictions');
            const seasonDiv = document.createElement('div');
            seasonDiv.innerHTML = `<h5>${season} Historical Predictions</h5>`;
            predictions.forEach(prediction => {
                const div = document.createElement('div');
                div.classList.add('mb-2');
                div.innerHTML = `
                    <strong>Date:</strong> ${prediction.date}
                    <br>
                    <strong>Forecast Sales:</strong> ₱${prediction.forecast_sales}
                    <br>
                    <strong>Forecast Quantity:</strong> ${prediction.forecast_quantity}
                `;
                seasonDiv.appendChild(div);
            });
            container.appendChild(seasonDiv);
        }

        // Render future predictions
        function renderFuturePredictions(predictions, season) {
            const container = document.getElementById('future-predictions');
            const seasonDiv = document.createElement('div');
            seasonDiv.innerHTML = `<h5>${season} Future Predictions</h5>`;
            predictions.forEach(prediction => {
                const div = document.createElement('div');
                div.classList.add('mb-2');
                div.innerHTML = `
                    <strong>Date:</strong> ${prediction.date}
                    <br>
                    <strong>Forecast Sales:</strong> ₱${prediction.forecast_sales}
                    <br>
                    <strong>Forecast Quantity:</strong> ${prediction.forecast_quantity}
                `;
                seasonDiv.appendChild(div);
            });
            container.appendChild(seasonDiv);
        }

        // Render season charts
        function renderCharts(seasonData, chartId, seasonLabel) {
            const ctx = document.getElementById(chartId).getContext('2d');
            const chartData = {
                labels: seasonData.dates,
                datasets: [
                    {
                        label: `${seasonLabel} - Sales`,
                        data: seasonData.sales,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false
                    },
                    {
                        label: `${seasonLabel} - Quantity`,
                        data: seasonData.quantity,
                        borderColor: 'rgba(153, 102, 255, 1)',
                        fill: false
                    }
                ]
            };

            new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Amount'
                            }
                        }
                    }
                });
        }

        // Load data on page load
        window.onload = fetchForecastData;
    </script>
</body>

</html>
