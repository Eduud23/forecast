<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sales Forecast Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
    }

    .container {
      max-width: 100%;
      padding: 20px;
    }

    .card {
      margin-bottom: 20px;
    }

    h1,
    h3,
    h5 {
      color: #333;
    }

    .forecast-summary-card {
      background-color: #ffffff;
      border-left: 5px solid #007bff;
    }

    .forecast-summary-card h5 {
      color: #007bff;
    }

    .chart-wrapper {
      position: relative;
      width: 100%;
      height: 300px;
      margin-bottom: 30px;
    }

    .section-header {
      margin-bottom: 15px;
      font-weight: 600;
    }

    .prediction-entry {
      margin-bottom: 15px;
      padding: 15px;
      background-color: #ffffff;
      border-left: 4px solid #6c757d;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .prediction-entry p {
      margin: 5px 0;
    }

    @media (max-width: 768px) {
      .forecast-summary-card {
        margin-bottom: 15px;
      }

      .chart-wrapper {
        height: 250px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1 class="text-center mb-4">Sales & Quantity Forecast</h1>

    <!-- Forecast Summary -->
    <div id="forecast-container" class="mb-4">
      <h3 class="section-header">Forecast Summary</h3>
      <div id="forecast-summary" class="row"></div>
    </div>

    <!-- Dry Season Chart -->
    <div class="mb-4">
      <h3 class="section-header">Dry Season Chart</h3>
      <div class="chart-wrapper">
        <canvas id="dry-season-chart"></canvas>
      </div>
    </div>

    <!-- Rainy Season Chart -->
    <div class="mb-4">
      <h3 class="section-header">Rainy Season Chart</h3>
      <div class="chart-wrapper">
        <canvas id="rainy-season-chart"></canvas>
      </div>
    </div>

    <!-- Dry Season Future Forecast Chart -->
    <div class="mb-4">
      <h3 class="section-header">Dry Season Future Forecast</h3>
      <div class="chart-wrapper">
        <canvas id="dry-future-chart"></canvas>
      </div>
    </div>

    <!-- Rainy Season Future Forecast Chart -->
    <div class="mb-4">
      <h3 class="section-header">Rainy Season Future Forecast</h3>
      <div class="chart-wrapper">
        <canvas id="rainy-future-chart"></canvas>
      </div>
    </div>

    <!-- Historical Predictions -->
    <div class="mb-4">
      <h3 class="section-header">Historical Predictions</h3>
      <div id="historical-predictions"></div>
    </div>

    <!-- Future Predictions -->
    <div class="mb-4">
      <h3 class="section-header">Future Predictions</h3>
      <div id="future-predictions"></div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    async function fetchForecastData() {
      try {
        const response = await fetch('/forecast');
        const data = await response.json();

        renderForecastSummary(data.forecast_data);
        renderHistoricalPredictions(data.dry_historical_predictions, 'Dry Season');
        renderHistoricalPredictions(data.rainy_historical_predictions, 'Rainy Season');
        renderFuturePredictions(data.dry_forecast_monthly, 'Dry Season');
        renderFuturePredictions(data.rainy_forecast_monthly, 'Rainy Season');
        renderCharts(data.dry_season_data, 'dry-season-chart', 'Dry Season');
        renderCharts(data.rainy_season_data, 'rainy-season-chart', 'Rainy Season');
        renderCharts(data.dry_forecast_monthly, 'dry-future-chart', 'Dry Season Future');
        renderCharts(data.rainy_forecast_monthly, 'rainy-future-chart', 'Rainy Season Future');
      } catch (error) {
        console.error('Error fetching forecast data:', error);
      }
    }

    function renderForecastSummary(forecastData) {
      const container = document.getElementById('forecast-summary');
      container.innerHTML = '';
      forecastData.forEach(forecast => {
        const div = document.createElement('div');
        div.className = 'col-md-6';
        div.innerHTML = `
          <div class="card forecast-summary-card p-3">
            <h5>${forecast.label}</h5>
            <p>Total Sales Forecast: ₱${forecast.forecast_sales}</p>
            <p>Total Quantity Forecast: ${forecast.forecast_quantity}</p>
            <p>Sales Trend: ${forecast.trend_sales}</p>
            <p>Quantity Trend: ${forecast.trend_quantity}</p>
          </div>`;
        container.appendChild(div);
      });
    }

    function renderHistoricalPredictions(predictions, season) {
      const container = document.getElementById('historical-predictions');
      const seasonDiv = document.createElement('div');
      seasonDiv.innerHTML = `<h5 class="mt-3">${season} Historical Predictions</h5>`;
      predictions.forEach(prediction => {
        const div = document.createElement('div');
        div.className = 'prediction-entry';
        div.innerHTML = `
          <p><strong>Date:</strong> ${prediction.date}</p>
          <p><strong>Forecast Sales:</strong> ₱${prediction.forecast_sales}</p>
          <p><strong>Forecast Quantity:</strong> ${prediction.forecast_quantity}</p>`;
        seasonDiv.appendChild(div);
      });
      container.appendChild(seasonDiv);
    }

    function renderFuturePredictions(predictions, season) {
      const container = document.getElementById('future-predictions');
      const seasonDiv = document.createElement('div');
      seasonDiv.innerHTML = `<h5 class="mt-3">${season} Future Predictions</h5>`;
      predictions.forEach(prediction => {
        const div = document.createElement('div');
        div.className = 'prediction-entry';
        div.innerHTML = `
          <p><strong>Date:</strong> ${prediction.date}</p>
          <p><strong>Forecast Sales:</strong> ₱${prediction.forecast_sales}</p>
          <p><strong>Forecast Quantity:</strong> ${prediction.forecast_quantity}</p>`;
        seasonDiv.appendChild(div);
      });
      container.appendChild(seasonDiv);
    }

    function renderCharts(data, chartId, labelPrefix) {
      const labels = data.map(entry => entry.date);
      const sales = data.map(entry => entry.forecast_sales || entry.sales);
      const quantity = data.map(entry => entry.forecast_quantity || entry.quantity);

      const ctx = document.getElementById(chartId).getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: `${labelPrefix} - Sales`,
              data: sales,
              borderColor: 'rgba(75, 192, 192, 1)',
              fill: false
            },
            {
              label: `${labelPrefix} - Quantity`,
              data: quantity,
              borderColor: 'rgba(153, 102, 255, 1)',
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              title: {
                display: true,
                text: 'Date'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Amount'
              }
            }
          }
        }
      });
    }

    window.onload = fetchForecastData;
  </script>
</body>

</html>
