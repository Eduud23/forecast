<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Forecast</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f4f8, #c7e0e8);
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: auto;
        }

        h3 {
            color: #444;
        }

        canvas {
            margin-bottom: 10px;
        }

        button {
            padding: 8px 12px;
            background-color: #337ab7;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 10px 0;
            cursor: pointer;
        }

        ul {
            list-style-type: none;
            padding-left: 10px;
        }

        li {
            margin: 4px 0;
        }

        .forecast-text {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h3>Dry Season Sales Forecast (December to May)</h3>
        <canvas id="drySeasonChart"></canvas>
        <p class="forecast-text" id="drySeasonForecast">Dry Season Forecast Sales: <span></span></p>
        <button onclick="showCategoryForecast('Dry Season')">Show Dry Season Unit Forecasts</button>
        <ul id="dryCategoryForecasts"></ul>

        <h3>Rainy Season Sales Forecast (June to November)</h3>
        <canvas id="rainySeasonChart"></canvas>
        <p class="forecast-text" id="rainySeasonForecast">Rainy Season Forecast Sales: <span></span></p>
        <button onclick="showCategoryForecast('Rainy Season')">Show Rainy Season Unit Forecasts</button>
        <ul id="rainyCategoryForecasts"></ul>

        <h3>Next Month Sales Forecast</h3>
        <canvas id="nextMonthChart"></canvas>
        <p class="forecast-text" id="nextMonthForecast">Next Month Forecast Sales: <span></span></p>
    </div>

    <script>
        async function fetchForecastData() {
            const response = await fetch('/forecast');
            return response.json();
        }

        async function fetchCategoryForecasts() {
            const response = await fetch('/forecast-units');
            return response.json();
        }

        async function showCategoryForecast(season) {
            const data = await fetchCategoryForecasts();
            const listId = season === 'Dry Season' ? 'dryCategoryForecasts' : 'rainyCategoryForecasts';
            const target = document.getElementById(listId);
            target.innerHTML = '';

            data[season].forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.category}: ${item.forecast_units} units`;
                target.appendChild(li);
            });
        }

        async function renderCharts() {
            const forecastData = await fetchForecastData();

            const dry = forecastData.forecast_data.find(f => f.label.includes("Dry"));
            const rainy = forecastData.forecast_data.find(f => f.label.includes("Rainy"));
            const next = forecastData.forecast_data.find(f => f.label.includes("Next"));

            document.getElementById('drySeasonForecast').children[0].textContent = `${dry.forecast_sales} (${dry.trend})`;
            document.getElementById('rainySeasonForecast').children[0].textContent = `${rainy.forecast_sales} (${rainy.trend})`;
            document.getElementById('nextMonthForecast').children[0].textContent = `${next.forecast_sales} (${next.trend})`;

            const dryCtx = document.getElementById('drySeasonChart').getContext('2d');
            new Chart(dryCtx, {
                type: 'line',
                data: {
                    labels: forecastData.dry_season_specific_data.dates.concat(['Forecast']),
                    datasets: [{
                        label: 'Dry Season Sales',
                        data: forecastData.dry_season_specific_data.sales.concat(dry.forecast_sales),
                        borderColor: 'rgb(255,99,132)',
                        fill: false
                    }]
                }
            });

            const rainyCtx = document.getElementById('rainySeasonChart').getContext('2d');
            new Chart(rainyCtx, {
                type: 'line',
                data: {
                    labels: forecastData.rainy_season_specific_data.dates.concat(['Forecast']),
                    datasets: [{
                        label: 'Rainy Season Sales',
                        data: forecastData.rainy_season_specific_data.sales.concat(rainy.forecast_sales),
                        borderColor: 'rgb(54,162,235)',
                        fill: false
                    }]
                }
            });

            const nextCtx = document.getElementById('nextMonthChart').getContext('2d');
            new Chart(nextCtx, {
                type: 'line',
                data: {
                    labels: forecastData.historical_data.dates.concat(['Forecast']),
                    datasets: [{
                        label: 'Monthly Sales',
                        data: forecastData.historical_data.sales.concat(next.forecast_sales),
                        borderColor: 'rgb(75,192,192)',
                        fill: false
                    }]
                }
            });
        }

        renderCharts();
    </script>
</body>
</html>
